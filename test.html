<html>
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7SV03ZXJ9R"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-7SV03ZXJ9R');
    </script>
    <title>Infinite Campus</title>
    <link id="dynamic-favicon" rel="icon" type="image/png" href="https://codehs.com/uploads/f111a37947de2cea81db858094c04f2d">
    <link rel="stylesheet" href="global.css">
    <meta name="keywords" content="Infinite campus,infinite campus,Infinite Campus,infinite Campus">
    <meta name="description" content="Infinite Campus Is A International Buisiness And Has Good Devs">
    <meta property="og:title" content="Infinite Campus">
    <meta property="og:description" content="Infinite Campus Is An International Buisiness And Has Good Devs">
    <meta property="og:url" content="https://ryann-4.github.io/InfiniteCampus/">
    <meta name="theme-color" content="#8cbe37">
    <meta content="https://codehs.com/uploads/30883de2def50482be6e6fb25ea68477" property="og:image">
  </head>
  <body>
    <center>
      <br><br><br><br>
      <h1 class="txt">Log In</h1>
      <p class="r">Only Authorized Users May Log In</p>

      <input class="button" type="text" id="username" placeholder="Email" style="padding:10px;width:250px;">
      <br><br>
      <input class="button" type="password" id="password" placeholder="Password" style="padding:10px;width:250px;">
      <br><br>
      <button id="loginBtn" class="button">Log In</button>
      <p id="loginStatus"></p>
    </center>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
      import { 
        getAuth, 
        signInWithEmailAndPassword, 
        onAuthStateChanged 
      } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCd3Yi81oZbRFgcdc98e8hTatdM4pftYRs",
        authDomain: "infinitecampus-6e93c.firebaseapp.com",
        databaseURL: "https://infinitecampus-6e93c-default-rtdb.firebaseio.com",
        projectId: "infinitecampus-6e93c",
        storageBucket: "infinitecampus-6e93c.firebasestorage.app",
        messagingSenderId: "349851426947",
        appId: "1:349851426947:web:14cc56fab543ca91373bb6"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const loginBtn = document.getElementById("loginBtn");
      const loginStatus = document.getElementById("loginStatus");
      const usernameInput = document.getElementById("username");
      const passwordInput = document.getElementById("password");

      async function loginUser() {
        const email = usernameInput.value.trim();
        const password = passwordInput.value.trim();

        if (!email || !password) {
          loginStatus.textContent = "Please enter both email and password.";
          return;
        }

        try {
          await signInWithEmailAndPassword(auth, email, password);
          loginStatus.textContent = "Login successful!";
          // Delay slightly to avoid overlap with auth state change
          setTimeout(() => {
            window.location.href = "InfiniteSecretPages.html";
          }, 500);
        } catch (error) {
          loginStatus.textContent = "Error: " + error.message;
        }
      }

      loginBtn.addEventListener("click", loginUser);
      document.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          loginUser();
        }
      });

      // Only redirect if user is ALREADY logged in before reaching the login page
      onAuthStateChanged(auth, (user) => {
        if (user && !window.location.href.includes("InfiniteSecretPages.html")) {
          window.location.href = "InfiniteSecretPages.html";
        }
      });
    </script>
  </body>
</html>
